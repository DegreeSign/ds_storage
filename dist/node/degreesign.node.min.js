/*! For license information please see degreesign.node.min.js.LICENSE.txt */
(()=>{"use strict";var e={28:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.migrateSecure=t.getConfig=t.configureStorage=void 0;const a=r(896),o=r(205);let n,c="appData",s="appDB",i="appStorage";const d="appConfig";t.configureStorage=async({storageKey:e,dbName:t,storeName:r,encryptionKey:a})=>{try{await(async()=>{try{const e=localStorage.getItem(d);if(e){const t=JSON.parse(e);c=t.storageKey,s=t.dbName||s,i=t.storeName||i,n=t.encryptionKey?await(0,o.cryptoKey)(t.encryptionKey):void 0}}catch(e){console.log("initialiseConfig failed",e)}})();const y=localStorage.getItem(d);let l;y&&(l=JSON.parse(y));const g={storageKey:e,dbName:t||s,storeName:r||i,encryptionKey:a};localStorage.setItem(d,JSON.stringify(g)),c=e,g.dbName&&(s=g.dbName),g.storeName&&(i=g.storeName),n=a?await(0,o.cryptoKey)(a):void 0}catch(e){console.log("configureStorage failed",e)}},t.getConfig=()=>({STORAGE_KEY:c,DB_NAME:s,STORE_NAME:i,ENCRYPTION_KEY:n}),t.migrateSecure=async({storedKeys:e,newEncryptionKey:t,newDbName:r,newStoreName:c})=>{console.log("Data migration started...");const d=n,y=s,l=i;n=await(0,o.cryptoKey)(t)??n,s=r??s,i=c??i;for(let t=0;t<e.length;t++){const r=e[t];try{const e=await(0,a.readDB)({key:r,dbName:y,storeName:l}),t=e?d?await(0,o.decryptData)(e,d):JSON.parse(e):void 0,c=t?n?await(0,o.encryptData)(t,n):JSON.stringify(t):void 0;c&&await(0,a.saveDB)({key:r,data:c,dbName:s,storeName:i})}catch(e){console.log("migrateSecure failed",r,e)}}console.log("Data migration finished!")}},205:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decrypt=t.encrypt=t.decryptData=t.encryptData=t.cryptoKey=void 0;const a=r(28),o=async(e,t)=>{try{const r=crypto.getRandomValues(new Uint8Array(12)),a=(new TextEncoder).encode(JSON.stringify(e)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,a),n=new Uint8Array(o),c=new Uint8Array(r.length+n.length);return c.set(r),c.set(n,r.length),btoa(String.fromCharCode(...c))}catch(t){console.log("encryptData failed",t);try{return JSON.stringify(e)}catch(e){}}},n=async(e,t)=>{try{const r=Uint8Array.from(atob(e),e=>e.charCodeAt(0)),a=r.slice(0,12),o=r.slice(12),n=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},t,o);return JSON.parse((new TextDecoder).decode(n))}catch(e){console.log("decryptData failed",e)}};t.cryptoKey=async e=>{try{if(!e)return;const t=await crypto.subtle.importKey("raw",(new TextEncoder).encode(e),"PBKDF2",!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:(new TextEncoder).encode("salt"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}catch(e){console.log("processKey failed",e)}},t.encryptData=o,t.decryptData=n,t.encrypt=async e=>{try{const{ENCRYPTION_KEY:t}=(0,a.getConfig)();return t?await o(e,t):JSON.stringify(e)}catch(t){console.log("encrypt failed",t);try{return JSON.stringify(e)}catch(e){}}},t.decrypt=async e=>{try{const{ENCRYPTION_KEY:t}=(0,a.getConfig)();return t?await n(e,t):JSON.parse(e)}catch(e){console.log("decrypt failed",e)}}},247:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readSecure=t.saveSecure=void 0;const a=r(28),o=r(896),n=r(205);t.saveSecure=async({key:e,data:t})=>{try{const{DB_NAME:r,STORE_NAME:c}=(0,a.getConfig)();return await(0,o.saveDB)({key:e,data:t?await(0,n.encrypt)(t):void 0,dbName:r,storeName:c})}catch(e){console.log("saveSecure failed",e)}return!1},t.readSecure=async e=>{try{const{DB_NAME:t,STORE_NAME:r}=(0,a.getConfig)(),c=await(0,o.readDB)({key:e,dbName:t,storeName:r});return c?await(0,n.decrypt)(c):void 0}catch(e){console.log("readSecure failed",e)}}},421:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readData=t.saveData=void 0;t.saveData=({key:e,data:t})=>{try{void 0===t?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t))}catch(e){console.log("saveData failed",e)}},t.readData=e=>{try{const t=localStorage.getItem(e);return t?JSON.parse(t):void 0}catch(e){console.log("readData failed",e)}}},896:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readDB=t.saveDB=t.openDB=void 0;const a=r(28),o=({dbName:e,storeName:t,version:r=1}={})=>new Promise((o,n)=>{e=e||(0,a.getConfig)().DB_NAME;const c=indexedDB.open(e,r);c.onupgradeneeded=()=>{t=t||(0,a.getConfig)().STORE_NAME;const e=c.result;e.objectStoreNames.contains(t)||e.createObjectStore(t,{keyPath:"id"})},c.onsuccess=()=>o(c.result),c.onerror=()=>{console.log("openDB failed",c.error),n(c.error)}});t.openDB=o,t.saveDB=async({key:e,data:t,dbName:r,storeName:a})=>{try{const n=await o({dbName:r,storeName:a});return new Promise(r=>{const o=n.transaction([a],"readwrite").objectStore(a),c=t?o.put({id:e,data:t}):o.delete(e);c.onsuccess=()=>r(!0),c.onerror=()=>{console.log("saveDB error",c.error),r(!1)},n.close()})}catch(e){console.log("saveSecure failed",e)}return!1},t.readDB=async({key:e,dbName:t,storeName:r})=>{try{const a=await o({dbName:t,storeName:r});return new Promise(t=>{const o=a.transaction([r],"readonly").objectStore(r).get(e);o.onsuccess=()=>t(o?.result?.data),o.onerror=()=>{console.log("readDB error",o.error),t(void 0)},a.close()})}catch(e){console.log("readDB failed",e)}}},915:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readLarge=t.saveLarge=void 0;const a=r(28),o=r(896);t.saveLarge=async({key:e,data:t})=>{try{const{DB_NAME:r,STORE_NAME:n}=(0,a.getConfig)();return await(0,o.saveDB)({key:e,data:t?JSON.stringify(t):void 0,dbName:r,storeName:n})}catch(e){console.log("saveLarge failed",e)}return!1},t.readLarge=async e=>{try{const{DB_NAME:t,STORE_NAME:r}=(0,a.getConfig)(),n=await(0,o.readDB)({key:e,dbName:t,storeName:r});return n?JSON.parse(n):void 0}catch(e){console.log("readLarge failed",e)}}}},t={};function r(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,r),n.exports}var a={};(()=>{var e=a;Object.defineProperty(e,"__esModule",{value:!0}),e.decryptData=e.encryptData=e.saveSecure=e.readSecure=e.saveLarge=e.readLarge=e.saveData=e.readData=e.migrateSecure=e.getConfig=e.configureStorage=void 0;const t=r(28);Object.defineProperty(e,"configureStorage",{enumerable:!0,get:function(){return t.configureStorage}}),Object.defineProperty(e,"getConfig",{enumerable:!0,get:function(){return t.getConfig}}),Object.defineProperty(e,"migrateSecure",{enumerable:!0,get:function(){return t.migrateSecure}});const o=r(421);Object.defineProperty(e,"readData",{enumerable:!0,get:function(){return o.readData}}),Object.defineProperty(e,"saveData",{enumerable:!0,get:function(){return o.saveData}});const n=r(915);Object.defineProperty(e,"readLarge",{enumerable:!0,get:function(){return n.readLarge}}),Object.defineProperty(e,"saveLarge",{enumerable:!0,get:function(){return n.saveLarge}});const c=r(247);Object.defineProperty(e,"readSecure",{enumerable:!0,get:function(){return c.readSecure}}),Object.defineProperty(e,"saveSecure",{enumerable:!0,get:function(){return c.saveSecure}});const s=r(205);Object.defineProperty(e,"decryptData",{enumerable:!0,get:function(){return s.decryptData}}),Object.defineProperty(e,"encryptData",{enumerable:!0,get:function(){return s.encryptData}})})();var o=exports;for(var n in a)o[n]=a[n];a.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();