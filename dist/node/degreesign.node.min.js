/*! For license information please see degreesign.node.min.js.LICENSE.txt */
(()=>{"use strict";var e={28:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.migrateSecure=t.configureStorage=t.initialiseConfig=t.ENCRYPTION_KEY=t.STORE_NAME=t.DB_NAME=t.STORAGE_KEY=void 0;const a=r(205),o=r(247);let n,c="appData",i="appDB",s="appStorage";t.STORAGE_KEY=c,t.DB_NAME=i,t.STORE_NAME=s;const d="appConfig",y=async()=>{try{const e=localStorage.getItem(d);if(e){const r=JSON.parse(e);t.STORAGE_KEY=c=r.storageKey,t.DB_NAME=i=r.dbName||i,t.STORE_NAME=s=r.storeName||s,t.ENCRYPTION_KEY=n=r.encryptionKey?await(0,a.cryptoKey)(r.encryptionKey):void 0}}catch(e){console.log("initialiseConfig failed",e)}};t.initialiseConfig=y,t.configureStorage=async({storageKey:e,dbName:r,storeName:o,encryptionKey:y})=>{try{const l=localStorage.getItem(d);let u;l&&(u=JSON.parse(l));const g={storageKey:e,dbName:r||i,storeName:o||s,encryptionKey:y};localStorage.setItem(d,JSON.stringify(g)),t.STORAGE_KEY=c=e,g.dbName&&(t.DB_NAME=i=g.dbName),g.storeName&&(t.STORE_NAME=s=g.storeName),t.ENCRYPTION_KEY=n=y?await(0,a.cryptoKey)(y):void 0}catch(e){console.log("Error in configureStorage:",e)}},t.migrateSecure=async({storedKeys:e,newEncryptionKey:r,newDbName:c,newStoreName:d})=>{console.log("Data migration started...");const y=n,l=i,u=s;t.ENCRYPTION_KEY=n=await(0,a.cryptoKey)(r)??n,t.DB_NAME=i=c??i,t.STORE_NAME=s=d??s;for(let t=0;t<e.length;t++){const r=e[t];try{const e=await(0,o.readDB)({key:r,dbName:l,storeName:u}),t=e?y?await(0,a.decryptData)(e,y):JSON.parse(e):void 0,c=t?n?await(0,a.encryptData)(t,n):JSON.stringify(t):void 0;c&&await(0,o.saveDB)({key:r,data:c,dbName:i,storeName:s})}catch(e){console.log("migrateSecure failed",r,e)}}console.log("Data migration finished!")},y()},205:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.decrypt=t.encrypt=t.decryptData=t.encryptData=t.cryptoKey=void 0;const a=r(28),o=async(e,t)=>{try{const r=crypto.getRandomValues(new Uint8Array(12)),a=(new TextEncoder).encode(JSON.stringify(e)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},t,a),n=new Uint8Array(o),c=new Uint8Array(r.length+n.length);return c.set(r),c.set(n,r.length),btoa(String.fromCharCode(...c))}catch(t){console.log("encryptData failed",t);try{return JSON.stringify(e)}catch(e){}}},n=async(e,t)=>{try{const r=Uint8Array.from(atob(e),e=>e.charCodeAt(0)),a=r.slice(0,12),o=r.slice(12),n=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},t,o);return JSON.parse((new TextDecoder).decode(n))}catch(e){return void console.log("decryptData failed",e)}};t.cryptoKey=async e=>{try{if(!e)return;const t=await crypto.subtle.importKey("raw",(new TextEncoder).encode(e),"PBKDF2",!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:(new TextEncoder).encode("salt"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}catch(e){console.log("processKey failed",e)}},t.encryptData=o,t.decryptData=n,t.encrypt=async e=>{try{return a.ENCRYPTION_KEY?await o(e,a.ENCRYPTION_KEY):JSON.stringify(e)}catch(t){console.log("encrypt failed",t);try{return JSON.stringify(e)}catch(e){}}},t.decrypt=async e=>{try{return a.ENCRYPTION_KEY?await n(e,a.ENCRYPTION_KEY):JSON.parse(e)}catch(e){return void console.log("decrypt failed",e)}}},247:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readSecure=t.saveSecure=t.readDB=t.saveDB=t.openDB=void 0;const a=r(28),o=r(205),n=({dbName:e,storeName:t,version:r=1}={})=>new Promise((o,n)=>{e=e||a.DB_NAME;const c=indexedDB.open(e,r);c.onupgradeneeded=()=>{t=t||a.STORE_NAME;const e=c.result;e.objectStoreNames.contains(t)||e.createObjectStore(t,{keyPath:"id"})},c.onsuccess=()=>o(c.result),c.onerror=()=>{console.log("openDB error",c.error),n(c.error)}}),c=async({key:e,data:t,dbName:r,storeName:a})=>{try{const o=await n({dbName:r,storeName:a});return new Promise(r=>{const n=o.transaction([a],"readwrite").objectStore(a),c=t?n.put({id:e,data:t}):n.delete(e);c.onsuccess=()=>r(!0),c.onerror=()=>{console.log("saveDB error",c.error),r(!1)},o.close()})}catch(e){return console.log("saveSecure failed",e),!1}},i=async({key:e,dbName:t,storeName:r})=>{try{const a=await n({dbName:t,storeName:r});return new Promise(t=>{const o=a.transaction([r],"readonly").objectStore(r).get(e);o.onsuccess=()=>t(o?.result?.data),o.onerror=()=>{console.log("readDB error",o.error),t(void 0)},a.close()})}catch(e){return void console.log("readDB failed",e)}};t.openDB=n,t.saveDB=c,t.readDB=i,t.saveSecure=async({key:e,data:t})=>await c({key:e,data:t?await(0,o.encrypt)(t):void 0,dbName:a.DB_NAME,storeName:a.STORE_NAME}),t.readSecure=async e=>{try{const t=await i({key:e,dbName:a.DB_NAME,storeName:a.STORE_NAME});return t?await(0,o.decrypt)(t):void 0}catch(e){return void console.log("readSecure failed",e)}}},421:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.readData=t.saveData=void 0;t.saveData=({key:e,data:t})=>{try{void 0===t?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t))}catch(e){console.log("saveData failed",e)}},t.readData=e=>{try{const t=localStorage.getItem(e);return t?JSON.parse(t):void 0}catch(e){return void console.log("readData failed",e)}}}},t={};function r(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,r),n.exports}var a={};(()=>{var e=a;Object.defineProperty(e,"__esModule",{value:!0}),e.decryptData=e.encryptData=e.saveData=e.readData=e.saveSecure=e.readSecure=e.migrateSecure=e.configureStorage=e.initialiseConfig=void 0;const t=r(421);Object.defineProperty(e,"readData",{enumerable:!0,get:function(){return t.readData}}),Object.defineProperty(e,"saveData",{enumerable:!0,get:function(){return t.saveData}});const o=r(28);Object.defineProperty(e,"configureStorage",{enumerable:!0,get:function(){return o.configureStorage}}),Object.defineProperty(e,"initialiseConfig",{enumerable:!0,get:function(){return o.initialiseConfig}}),Object.defineProperty(e,"migrateSecure",{enumerable:!0,get:function(){return o.migrateSecure}});const n=r(247);Object.defineProperty(e,"readSecure",{enumerable:!0,get:function(){return n.readSecure}}),Object.defineProperty(e,"saveSecure",{enumerable:!0,get:function(){return n.saveSecure}});const c=r(205);Object.defineProperty(e,"decryptData",{enumerable:!0,get:function(){return c.decryptData}}),Object.defineProperty(e,"encryptData",{enumerable:!0,get:function(){return c.encryptData}})})();var o=exports;for(var n in a)o[n]=a[n];a.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();