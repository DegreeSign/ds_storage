/*! For license information please see degreesign.node.min.js.LICENSE.txt */
(()=>{"use strict";var e={28:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.migrateSecure=r.showError=r.getConfig=r.configureStorage=void 0;const a=t(896),o=t(205);let n,c="appData",s="appDB",i="appStorage",d=!1;const y="appConfig",l=()=>!d;r.configureStorage=async({storageKey:e,dbName:r,storeName:t,encryptionKey:a,hideErrors:g})=>{try{await(async()=>{try{const e=localStorage.getItem(y);if(e){const r=JSON.parse(e);c=r.storageKey,s=r.dbName||s,i=r.storeName||i,n=r.encryptionKey?await(0,o.cryptoKey)(r.encryptionKey):void 0,d=r.hideErrors??d}}catch(e){l()&&console.log("initialiseConfig failed",e)}})();const u=localStorage.getItem(y);let p;u&&(p=JSON.parse(u));const f={storageKey:e,dbName:r||s,storeName:t||i,encryptionKey:a};localStorage.setItem(y,JSON.stringify(f)),c=e,f.dbName&&(s=f.dbName),f.storeName&&(i=f.storeName),n=a?await(0,o.cryptoKey)(a):void 0,d=g??d}catch(e){l()&&console.log("configureStorage failed",e)}},r.getConfig=()=>({storageKey:c,dbName:s,storeName:i,ENCRYPTION_KEY:n,hideErrors:d}),r.showError=l,r.migrateSecure=async({storedKeys:e,newEncryptionKey:r,newDbName:t,newStoreName:c})=>{l()&&console.log("Data migration started...");const d=n,y=s,g=i;n=await(0,o.cryptoKey)(r)??n,s=t??s,i=c??i;for(let r=0;r<e.length;r++){const t=e[r];try{const e=await(0,a.readDB)({key:t,dbName:y,storeName:g}),r=e?d?await(0,o.decryptData)(e,d):JSON.parse(e):void 0,c=r?n?await(0,o.encryptData)(r,n):JSON.stringify(r):void 0;c&&await(0,a.saveDB)({key:t,data:c,dbName:s,storeName:i})}catch(e){l()&&console.log("migrateSecure failed",t,e)}}l()&&console.log("Data migration finished!")}},205:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.decrypt=r.encrypt=r.decryptData=r.encryptData=r.cryptoKey=void 0;const a=t(28),o=async(e,r)=>{try{const t=crypto.getRandomValues(new Uint8Array(12)),a=(new TextEncoder).encode(JSON.stringify(e)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},r,a),n=new Uint8Array(o),c=new Uint8Array(t.length+n.length);return c.set(t),c.set(n,t.length),btoa(String.fromCharCode(...c))}catch(r){(0,a.showError)()&&console.log("encryptData failed",r);try{return JSON.stringify(e)}catch(e){}}},n=async(e,r)=>{try{const t=Uint8Array.from(atob(e),e=>e.charCodeAt(0)),a=t.slice(0,12),o=t.slice(12),n=await crypto.subtle.decrypt({name:"AES-GCM",iv:a},r,o);return JSON.parse((new TextDecoder).decode(n))}catch(e){(0,a.showError)()&&console.log("decryptData failed",e)}};r.cryptoKey=async e=>{try{if(!e)return;const r=await crypto.subtle.importKey("raw",(new TextEncoder).encode(e),"PBKDF2",!1,["deriveKey"]);return await crypto.subtle.deriveKey({name:"PBKDF2",salt:(new TextEncoder).encode("salt"),iterations:1e5,hash:"SHA-256"},r,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}catch(e){(0,a.showError)()&&console.log("processKey failed",e)}},r.encryptData=o,r.decryptData=n,r.encrypt=async e=>{try{const{ENCRYPTION_KEY:r}=(0,a.getConfig)();return r?await o(e,r):JSON.stringify(e)}catch(r){(0,a.showError)()&&console.log("encrypt failed",r);try{return JSON.stringify(e)}catch(e){}}},r.decrypt=async e=>{try{const{ENCRYPTION_KEY:r}=(0,a.getConfig)();return r?await n(e,r):JSON.parse(e)}catch(e){(0,a.showError)()&&console.log("decrypt failed",e)}}},247:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.readSecure=r.saveSecure=void 0;const a=t(28),o=t(896),n=t(205);r.saveSecure=async({key:e,data:r})=>{try{const{dbName:t,storeName:c}=(0,a.getConfig)();return await(0,o.saveDB)({key:e,data:r?await(0,n.encrypt)(r):void 0,dbName:t,storeName:c})}catch(e){(0,a.showError)()&&console.log("saveSecure failed",e)}return!1},r.readSecure=async e=>{try{const{dbName:r,storeName:t}=(0,a.getConfig)(),c=await(0,o.readDB)({key:e,dbName:r,storeName:t});return c?await(0,n.decrypt)(c):void 0}catch(e){(0,a.showError)()&&console.log("readSecure failed",e)}}},421:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.readData=r.saveData=void 0;const a=t(28);r.saveData=({key:e,data:r})=>{try{void 0===r?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(r))}catch(e){(0,a.showError)()&&console.log("saveData failed",e)}},r.readData=e=>{try{const r=localStorage.getItem(e);return r?JSON.parse(r):void 0}catch(e){(0,a.showError)()&&console.log("readData failed",e)}}},896:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.readDB=r.saveDB=r.openDB=void 0;const a=t(28),o=({dbName:e,storeName:r,version:t=1}={})=>new Promise((o,n)=>{e=e||(0,a.getConfig)().dbName;const c=indexedDB.open(e,t);c.onupgradeneeded=()=>{r=r||(0,a.getConfig)().storeName;const e=c.result;e.objectStoreNames.contains(r)||e.createObjectStore(r,{keyPath:"id"})},c.onsuccess=()=>o(c.result),c.onerror=()=>{(0,a.showError)()&&console.log("openDB failed",c.error),n(c.error)}});r.openDB=o,r.saveDB=async({key:e,data:r,dbName:t,storeName:n})=>{try{const c=await o({dbName:t,storeName:n});return new Promise(t=>{const o=c.transaction([n],"readwrite").objectStore(n),s=r?o.put({id:e,data:r}):o.delete(e);s.onsuccess=()=>t(!0),s.onerror=()=>{(0,a.showError)()&&console.log("saveDB error",s.error),t(!1)},c.close()})}catch(e){(0,a.showError)()&&console.log("saveSecure failed",e)}return!1},r.readDB=async({key:e,dbName:r,storeName:t})=>{try{const n=await o({dbName:r,storeName:t});return new Promise(r=>{const o=n.transaction([t],"readonly").objectStore(t).get(e);o.onsuccess=()=>r(o?.result?.data),o.onerror=()=>{(0,a.showError)()&&console.log("readDB error",o.error),r(void 0)},n.close()})}catch(e){(0,a.showError)()&&console.log("readDB failed",e)}}},915:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.readLarge=r.saveLarge=void 0;const a=t(28),o=t(896);r.saveLarge=async({key:e,data:r})=>{try{const{dbName:t,storeName:n}=(0,a.getConfig)();return await(0,o.saveDB)({key:e,data:r?JSON.stringify(r):void 0,dbName:t,storeName:n})}catch(e){(0,a.showError)()&&console.log("saveLarge failed",e)}return!1},r.readLarge=async e=>{try{const{dbName:r,storeName:t}=(0,a.getConfig)(),n=await(0,o.readDB)({key:e,dbName:r,storeName:t});return n?JSON.parse(n):void 0}catch(e){(0,a.showError)()&&console.log("readLarge failed",e)}}}},r={};function t(a){var o=r[a];if(void 0!==o)return o.exports;var n=r[a]={exports:{}};return e[a](n,n.exports,t),n.exports}var a={};(()=>{var e=a;Object.defineProperty(e,"__esModule",{value:!0}),e.decryptData=e.encryptData=e.saveSecure=e.readSecure=e.saveLarge=e.readLarge=e.saveData=e.readData=e.migrateSecure=e.getConfig=e.configureStorage=void 0;const r=t(28);Object.defineProperty(e,"configureStorage",{enumerable:!0,get:function(){return r.configureStorage}}),Object.defineProperty(e,"getConfig",{enumerable:!0,get:function(){return r.getConfig}}),Object.defineProperty(e,"migrateSecure",{enumerable:!0,get:function(){return r.migrateSecure}});const o=t(421);Object.defineProperty(e,"readData",{enumerable:!0,get:function(){return o.readData}}),Object.defineProperty(e,"saveData",{enumerable:!0,get:function(){return o.saveData}});const n=t(915);Object.defineProperty(e,"readLarge",{enumerable:!0,get:function(){return n.readLarge}}),Object.defineProperty(e,"saveLarge",{enumerable:!0,get:function(){return n.saveLarge}});const c=t(247);Object.defineProperty(e,"readSecure",{enumerable:!0,get:function(){return c.readSecure}}),Object.defineProperty(e,"saveSecure",{enumerable:!0,get:function(){return c.saveSecure}});const s=t(205);Object.defineProperty(e,"decryptData",{enumerable:!0,get:function(){return s.decryptData}}),Object.defineProperty(e,"encryptData",{enumerable:!0,get:function(){return s.encryptData}})})();var o=exports;for(var n in a)o[n]=a[n];a.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();